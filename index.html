<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LegalScraper | OPPORTIUM</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --grafite:#2C2C2C;--off-white:#F5F5F5;--surface:#FAFAFA;
  --azul-petroleo:#006064;--azul-petroleo-light:#00838F;
  --laranja:#E85D1A;--laranja-light:#FF6F33;
  --border:#E0E0E0;--border-light:#EEEEEE;--text-muted:#757575;
  --success:#2E7D32;--success-bg:#E8F5E9;--warning:#EF6C00;--warning-bg:#FFF3E0;
  --error:#C62828;--error-bg:#FFEBEE;--info-bg:#E0F2F1;
  --font-sans:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
  --font-mono:'JetBrains Mono','SF Mono','Consolas',monospace;
}
body{font-family:var(--font-sans);background:var(--off-white);color:var(--grafite);line-height:1.5}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}

.login-wrapper{height:100vh;display:flex;align-items:center;justify-content:center;background:var(--grafite);position:relative;overflow:hidden}
.login-bg{position:absolute;inset:0;background:radial-gradient(circle at 20% 50%,rgba(0,96,100,0.12) 0%,transparent 50%),radial-gradient(circle at 80% 20%,rgba(232,93,26,0.08) 0%,transparent 40%);pointer-events:none}
.login-container{position:relative;z-index:1;display:flex;flex-direction:column;align-items:center;width:100%;max-width:360px;padding:0 20px;animation:fadeUp .4s ease-out}
.login-brand{text-align:center;margin-bottom:20px}
.login-brand-name{font-size:11px;font-weight:100;letter-spacing:.3em;text-transform:uppercase;color:rgba(255,255,255,0.45);margin-bottom:4px}
.login-product{font-size:26px;font-weight:700;color:#fff;letter-spacing:-.02em}
.login-product span{color:rgba(255,255,255,0.50)}
.login-card{width:100%;background:#fff;border-radius:10px;padding:24px 22px;box-shadow:0 16px 48px rgba(0,0,0,0.25)}
.login-title{font-size:15px;font-weight:700;color:var(--grafite);margin-bottom:2px}
.login-subtitle{font-size:11px;color:var(--text-muted);margin-bottom:16px}
.field-group{margin-bottom:12px}
.field-group label{display:block;font-size:10px;font-weight:600;color:var(--grafite);margin-bottom:4px;letter-spacing:.02em}
.field-group input{width:100%;padding:9px 11px;border:1.5px solid var(--border);border-radius:5px;font-size:13px;font-family:inherit;color:var(--grafite);outline:none;transition:border-color .15s;background:#fff}
.field-group input:focus{border-color:var(--azul-petroleo)}
.password-wrap{position:relative}
.password-toggle{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:10px;font-family:inherit;font-weight:500}
.captcha-box{display:flex;align-items:center;gap:8px;padding:9px 11px;border:1.5px solid var(--border);border-radius:5px;margin-bottom:14px;cursor:pointer;transition:border-color .15s;background:var(--off-white)}
.captcha-box.checked{border-color:var(--success);background:var(--success-bg)}
.captcha-checkbox{width:16px;height:16px;border-radius:3px;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;background:#fff;transition:all .15s;flex-shrink:0}
.captcha-box.checked .captcha-checkbox{border-color:var(--success);background:var(--success)}
.captcha-label{font-size:11px;color:var(--grafite);flex:1}
.captcha-brand{font-size:8px;color:var(--text-muted);font-weight:600;letter-spacing:.04em}
.login-btn{width:100%;padding:10px;background:var(--azul-petroleo);color:#fff;border:none;border-radius:5px;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;transition:background .15s;display:flex;align-items:center;justify-content:center;gap:6px}
.login-btn:hover{background:var(--azul-petroleo-light)}
.login-btn:disabled{opacity:.7;cursor:not-allowed}
.login-btn .spinner{width:14px;height:14px;border:2px solid rgba(255,255,255,0.3);border-top-color:#fff;border-radius:50%;animation:spin .7s linear infinite}
.login-error{background:var(--error-bg);color:var(--error);font-size:11px;font-weight:500;padding:7px 10px;border-radius:5px;margin-bottom:12px;display:flex;align-items:center;gap:5px}
.login-footer{margin-top:16px;text-align:center;font-size:9px;color:rgba(255,255,255,0.2)}
.watermark{position:fixed;bottom:10px;right:14px;font-size:8px;color:rgba(255,255,255,0.12);letter-spacing:.04em;z-index:10;pointer-events:none}
.watermark-app{color:rgba(0,0,0,0.06)}

.app{display:none;min-height:100vh;background:var(--off-white)}
.app.active{display:flex}
.sidebar{width:220px;min-width:220px;background:var(--grafite);color:#fff;display:flex;flex-direction:column;padding:18px 0;position:fixed;top:0;left:0;height:100vh;overflow-y:auto;z-index:50}
.logo{padding:0 18px 18px;border-bottom:1px solid rgba(255,255,255,0.08)}
.logo-text{font-size:10px;font-weight:100;letter-spacing:.25em;text-transform:uppercase;color:rgba(255,255,255,0.40);margin-bottom:3px}
.logo-product{font-size:17px;font-weight:700;color:#fff;letter-spacing:-.01em}
.logo-product span{color:rgba(255,255,255,0.50)}
.menu-label{font-size:10px;font-weight:100;letter-spacing:.2em;text-transform:uppercase;color:rgba(255,255,255,0.30);padding:20px 18px 10px}
nav{flex:1;padding:0 10px;display:flex;flex-direction:column;gap:3px}
.nav-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:6px;cursor:pointer;font-size:13px;font-weight:400;color:rgba(255,255,255,0.60);background:transparent;transition:all .15s;border:none;width:100%;text-align:left;font-family:inherit}
.nav-item:hover{color:rgba(255,255,255,0.85);background:rgba(255,255,255,0.05)}
.nav-item.active{font-weight:600;color:#fff;background:var(--azul-petroleo)}
.nav-badge{margin-left:auto;background:var(--laranja);color:#fff;font-size:9px;font-weight:700;border-radius:8px;padding:2px 6px;min-width:16px;text-align:center}
.sidebar-footer{padding:14px 18px;border-top:1px solid rgba(255,255,255,0.08);margin-top:auto}
.sidebar-user{display:flex;align-items:center;gap:10px}
.sidebar-avatar{width:32px;height:32px;border-radius:50%;background:var(--azul-petroleo-light);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#fff;flex-shrink:0}
.sidebar-user-info{flex:1;min-width:0}
.sidebar-user-name{font-size:12px;font-weight:600;color:#fff;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.sidebar-user-role{font-size:10px;color:rgba(255,255,255,0.40)}
.sidebar-logout{background:none;border:none;color:rgba(255,255,255,0.40);cursor:pointer;padding:4px;border-radius:4px;display:flex}
.sidebar-logout:hover{color:rgba(255,255,255,0.8);background:rgba(255,255,255,0.05)}

.main{flex:1;margin-left:220px;padding:28px 36px;min-height:100vh}
.page{display:none;animation:fadeIn .2s ease}
.page.active{display:block}
.page-header{margin-bottom:24px}
.page-title{font-size:22px;font-weight:700;color:var(--grafite);letter-spacing:-.02em;margin-bottom:4px}
.page-subtitle{font-size:13px;color:var(--text-muted)}

.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:28px}
.stat-card{background:#fff;border-radius:12px;padding:24px 28px;box-shadow:0 2px 8px rgba(0,0,0,0.04)}
.stat-card.accent-teal{border-left:4px solid var(--azul-petroleo)}
.stat-card.accent-orange{border-left:4px solid var(--laranja)}
.stat-card.accent-green{border-left:4px solid var(--success)}
.stat-label{font-size:13px;color:var(--text-muted);font-weight:500;margin-bottom:10px}
.stat-value{font-size:36px;font-weight:700;color:var(--grafite);letter-spacing:-.02em}
.stat-meta{font-size:12px;color:var(--text-muted);margin-top:10px}

.card{background:#fff;border-radius:12px;padding:24px 28px;box-shadow:0 2px 8px rgba(0,0,0,0.04);margin-bottom:24px}
.card-title{font-size:15px;font-weight:700;color:var(--grafite);margin-bottom:18px}

.btn-primary{display:inline-flex;align-items:center;gap:8px;padding:12px 22px;background:var(--azul-petroleo);color:#fff;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;transition:background .15s;font-family:inherit}
.btn-primary:hover{background:var(--azul-petroleo-light)}
.btn-primary:disabled{opacity:.6;cursor:not-allowed}
.btn-secondary{display:inline-flex;align-items:center;gap:8px;padding:12px 22px;background:transparent;color:var(--azul-petroleo);border:2px solid var(--azul-petroleo);border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;transition:all .15s;font-family:inherit}
.btn-secondary:hover{background:var(--info-bg)}
.btn-success{display:inline-flex;align-items:center;gap:8px;padding:12px 22px;background:var(--success);color:#fff;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;transition:background .15s;font-family:inherit}
.btn-success:hover{background:#1b5e20}

.tribunal-tags{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}
.tribunal-tag{padding:10px 20px;border-radius:24px;font-size:13px;font-weight:600;cursor:pointer;border:2px solid var(--border);background:#fff;color:var(--text-muted);transition:all .15s;font-family:inherit}
.tribunal-tag:hover{border-color:var(--azul-petroleo);color:var(--azul-petroleo)}
.tribunal-tag.active{border-color:var(--azul-petroleo);background:var(--azul-petroleo);color:#fff}
.tribunal-tag.tjsp.active{border-color:var(--azul-petroleo);background:var(--azul-petroleo)}
.tribunal-tag.tjgo.active{border-color:var(--laranja);background:var(--laranja)}

.search-row{display:flex;gap:14px;align-items:center;flex-wrap:wrap}
.search-row select{padding:12px 16px;border:2px solid var(--border);border-radius:8px;font-size:14px;font-family:inherit;background:#fff;color:var(--grafite);cursor:pointer;outline:none}
.search-row select:focus{border-color:var(--azul-petroleo)}

.processo-card{background:#fff;border-radius:12px;padding:22px 28px;box-shadow:0 2px 8px rgba(0,0,0,0.04);margin-bottom:16px;border:2px solid transparent;transition:border-color .15s,box-shadow .15s;cursor:pointer}
.processo-card:hover{border-color:var(--azul-petroleo);box-shadow:0 6px 24px rgba(0,96,100,0.12)}
.processo-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px}
.processo-cnj{font-size:15px;font-weight:700;font-family:var(--font-mono);color:var(--azul-petroleo)}
.tribunal-badge{font-size:11px;font-weight:700;color:#fff;padding:5px 12px;border-radius:6px;letter-spacing:.04em}
.tribunal-badge.tjsp{background:var(--azul-petroleo)}
.tribunal-badge.tjgo{background:var(--laranja)}
.tribunal-badge.tjxx{background:var(--text-muted)}
.status-badge{font-size:12px;font-weight:600;padding:5px 14px;border-radius:14px}
.status-badge.ativo{color:var(--success);background:var(--success-bg)}
.status-badge.suspenso{color:var(--warning);background:var(--warning-bg)}
.status-badge.arquivado{color:var(--text-muted);background:var(--off-white)}
.status-badge.andamento{color:var(--azul-petroleo);background:var(--info-bg)}
.processo-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px 32px;font-size:14px}
.processo-label{color:var(--text-muted);font-size:11px;font-weight:500;text-transform:uppercase;letter-spacing:.04em;margin-bottom:4px}
.processo-value{color:var(--grafite);font-weight:500}
.processo-value.valor{color:var(--success);font-weight:700;font-size:15px}
.processo-mov{display:flex;align-items:center;gap:10px;margin-top:16px;padding:12px 16px;background:var(--off-white);border-radius:8px;font-size:13px;color:var(--grafite)}
.dot{width:8px;height:8px;border-radius:50%;background:var(--azul-petroleo)}

.loading-container{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;color:var(--text-muted)}
.loading-spinner{width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--azul-petroleo);border-radius:50%;animation:spin .8s linear infinite;margin-bottom:16px}
.loading-text{font-size:15px}
.empty-state{text-align:center;padding:60px 20px;color:var(--text-muted)}
.empty-icon{font-size:48px;margin-bottom:16px;opacity:.3}
.empty-title{font-size:16px;font-weight:600;margin-bottom:8px;color:var(--grafite)}

.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.4);display:none;align-items:center;justify-content:center;z-index:100;backdrop-filter:blur(3px)}
.modal-overlay.active{display:flex}
.modal{background:#fff;border-radius:14px;padding:32px;width:90%;max-width:700px;max-height:85vh;overflow:auto;box-shadow:0 24px 72px rgba(0,0,0,0.15);animation:fadeUp .2s ease}
.modal-header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:20px}
.modal-close{background:none;border:none;color:var(--text-muted);cursor:pointer;padding:4px}
.modal-close:hover{color:var(--grafite)}
.modal-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px 32px}
.modal hr{border:none;border-top:1px solid var(--border-light);margin:20px 0}
.modal-actions{display:flex;gap:14px;margin-top:20px}
.modal-tabs{display:flex;gap:10px;margin-bottom:20px;border-bottom:1px solid var(--border-light);padding-bottom:14px}
.modal-tab{padding:10px 18px;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;border:none;background:transparent;color:var(--text-muted);font-family:inherit}
.modal-tab.active{background:var(--info-bg);color:var(--azul-petroleo)}
.modal-tab:hover:not(.active){background:var(--off-white)}
.parte-card{background:var(--off-white);border-radius:10px;padding:18px;margin-bottom:14px}
.parte-tipo{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.04em;margin-bottom:6px}
.parte-tipo.autor{color:var(--azul-petroleo)}
.parte-tipo.reu{color:var(--laranja)}
.parte-nome{font-size:15px;font-weight:600;color:var(--grafite);margin-bottom:4px}
.parte-doc{font-size:13px;color:var(--text-muted)}
.parte-adv{font-size:13px;color:var(--grafite);margin-top:10px;padding-top:10px;border-top:1px solid var(--border-light)}

.export-option{display:flex;align-items:center;gap:18px;padding:22px 26px;background:#fff;border:2px solid var(--border);border-radius:12px;cursor:pointer;transition:all .15s;margin-bottom:16px}
.export-option:hover{border-color:var(--azul-petroleo);background:var(--info-bg)}
.export-option.selected{border-color:var(--azul-petroleo);background:var(--info-bg)}
.export-icon{font-size:36px}
.export-title{font-size:16px;font-weight:600;color:var(--grafite)}
.export-desc{font-size:14px;color:var(--text-muted);margin-top:4px}

.toast{position:fixed;bottom:28px;right:28px;background:var(--success);color:#fff;padding:16px 26px;border-radius:10px;box-shadow:0 6px 24px rgba(0,0,0,0.2);z-index:200;font-size:15px;font-weight:500;display:none;align-items:center;gap:12px;animation:fadeUp .25s ease}
.toast.active{display:flex}
.toast.error{background:var(--error)}

.quick-actions{display:flex;gap:16px;flex-wrap:wrap}

@media(max-width:1200px){.processo-grid{grid-template-columns:1fr 1fr}}
@media(max-width:900px){.stats-grid{grid-template-columns:1fr}.processo-grid{grid-template-columns:1fr}.modal-grid{grid-template-columns:1fr}.main{padding:24px 28px}}
@media(max-width:700px){.sidebar{display:none}.main{margin-left:0}}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage" class="login-wrapper">
  <div class="login-bg"></div>
  <div class="login-container">
    <div class="login-brand">
      <div class="login-brand-name">Opportium</div>
      <div class="login-product">Legal<span>Scraper</span></div>
    </div>
    <div class="login-card">
      <div class="login-title">Entrar</div>
      <div class="login-subtitle">Acesse com suas credenciais</div>
      <div id="loginError" class="login-error" style="display:none"><span>‚ö†</span> <span id="loginErrorText"></span></div>
      <div class="field-group"><label>Usu√°rio</label><input type="text" id="loginUsername" placeholder="seu_usuario"></div>
      <div class="field-group"><label>Senha</label><div class="password-wrap"><input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"><button type="button" class="password-toggle" onclick="togglePassword()">Mostrar</button></div></div>
      <div id="captchaBox" class="captcha-box" onclick="toggleCaptcha()">
        <div class="captcha-checkbox"><svg class="captcha-check" style="display:none" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div>
        <span class="captcha-label">N√£o sou um rob√¥</span><span class="captcha-brand">hCaptcha</span>
      </div>
      <button class="login-btn" id="loginBtn" onclick="handleLogin()">Entrar</button>
    </div>
    <div class="login-footer">v1.6.1</div>
  </div>
  <div class="watermark">¬© 2026 Opportium</div>
</div>

<!-- APP -->
<div id="app" class="app">
  <aside class="sidebar">
    <div class="logo"><div class="logo-text">Opportium</div><div class="logo-product">Legal<span>Scraper</span></div></div>
    <div class="menu-label">Menu</div>
    <nav>
      <button class="nav-item active" data-page="inicio" onclick="showPage('inicio',this)"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg> In√≠cio</button>
      <button class="nav-item" data-page="consultar" onclick="showPage('consultar',this)"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg> Consultar</button>
      <button class="nav-item" data-page="watchlist" onclick="showPage('watchlist',this)"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/></svg> Watchlist <span class="nav-badge" id="watchBadge">0</span></button>
      <button class="nav-item" data-page="exportar" onclick="showPage('exportar',this)"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> Exportar</button>
    </nav>
    <div class="sidebar-footer">
      <div class="sidebar-user">
        <div class="sidebar-avatar" id="sidebarAvatar">A</div>
        <div class="sidebar-user-info"><div class="sidebar-user-name" id="sidebarName">Usu√°rio</div><div class="sidebar-user-role" id="sidebarRole">Operador</div></div>
        <button class="sidebar-logout" onclick="handleLogout()" title="Sair"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg></button>
      </div>
    </div>
  </aside>
  <main class="main">
    <!-- IN√çCIO -->
    <div id="page-inicio" class="page active">
      <div class="page-header"><div class="page-title">In√≠cio</div><div class="page-subtitle" id="dashTimestamp"></div></div>
      <div class="stats-grid">
        <div class="stat-card accent-teal"><div class="stat-label">Processos Monitorados</div><div class="stat-value" id="statWatched">0</div><div class="stat-meta">Na sua watchlist</div></div>
        <div class="stat-card accent-orange"><div class="stat-label">√öltima Busca</div><div class="stat-value" id="statLastSearch">-</div><div class="stat-meta">Resultados encontrados</div></div>
        <div class="stat-card accent-green"><div class="stat-label">Bancos Cobertos</div><div class="stat-value">3</div><div class="stat-meta">Santander, Bradesco, BB</div></div>
      </div>
      <div class="card"><div class="card-title">A√ß√µes R√°pidas</div><div class="quick-actions">
        <button class="btn-primary" onclick="showPage('consultar',document.querySelector('[data-page=consultar]'))"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg> Nova Consulta</button>
        <button class="btn-secondary" onclick="showPage('watchlist',document.querySelector('[data-page=watchlist]'))"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/></svg> Ver Watchlist</button>
        <button class="btn-secondary" onclick="showPage('exportar',document.querySelector('[data-page=exportar]'))"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> Exportar</button>
      </div></div>
    </div>

    <!-- CONSULTAR -->
    <div id="page-consultar" class="page">
      <div class="page-header"><div class="page-title">Consultar Processos</div><div class="page-subtitle">Selecione o tribunal e clique em Buscar</div></div>
      <div class="card">
        <div class="card-title">Filtrar por Tribunal</div>
        <div class="tribunal-tags">
          <button class="tribunal-tag active" onclick="selectTribunal(this,'')">Todos</button>
          <button class="tribunal-tag tjsp" onclick="selectTribunal(this,'TJSP')">TJSP</button>
          <button class="tribunal-tag tjgo" onclick="selectTribunal(this,'TJGO')">TJGO</button>
        </div>
        <div class="search-row">
          <select id="searchLimit"><option value="20">20 resultados</option><option value="50">50 resultados</option><option value="100">100 resultados</option></select>
          <button class="btn-primary" id="searchBtn" onclick="doSearch()"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg> Buscar</button>
        </div>
      </div>
      <div id="searchLoading" class="loading-container" style="display:none"><div class="loading-spinner"></div><div class="loading-text">Buscando processos...</div></div>
      <div id="searchEmpty" class="empty-state"><div class="empty-icon">‚öñÔ∏è</div><div class="empty-title">Fa√ßa uma consulta</div><div style="font-size:14px;margin-top:8px">Selecione o tribunal e clique em Buscar</div></div>
      <div id="searchError" class="empty-state" style="display:none"><div class="empty-icon">‚ö†Ô∏è</div><div class="empty-title">Erro</div><div id="searchErrorText" style="font-size:14px;margin-top:8px"></div></div>
      <div id="searchResultsCount" style="display:none;font-size:14px;color:var(--text-muted);margin-bottom:18px"></div>
      <div id="searchResults"></div>
    </div>

    <!-- WATCHLIST -->
    <div id="page-watchlist" class="page">
      <div class="page-header"><div class="page-title">Watchlist</div><div class="page-subtitle" id="watchSubtitle">Processos monitorados</div></div>
      <div id="watchLoading" class="loading-container" style="display:none"><div class="loading-spinner"></div><div class="loading-text">Carregando...</div></div>
      <div id="watchResults"></div>
      <div id="watchEmpty" class="empty-state"><div class="empty-icon">üëÅÔ∏è</div><div class="empty-title">Watchlist vazia</div><div style="font-size:14px;margin-top:8px">Adicione processos para monitorar</div></div>
    </div>

    <!-- EXPORTAR -->
    <div id="page-exportar" class="page">
      <div class="page-header"><div class="page-title">Exportar Dados</div><div class="page-subtitle">Exporte seus dados para Excel</div></div>
      <div class="card">
        <div class="card-title">Selecione os dados para exportar</div>
        <div class="export-option selected" onclick="selectExportOption(this,'busca')"><div class="export-icon">üìä</div><div><div class="export-title">√öltima Busca</div><div class="export-desc" id="exportBuscaDesc">Nenhuma busca realizada</div></div></div>
        <div class="export-option" onclick="selectExportOption(this,'watchlist')"><div class="export-icon">üëÅÔ∏è</div><div><div class="export-title">Watchlist</div><div class="export-desc" id="exportWatchDesc">0 processos monitorados</div></div></div>
      </div>
      <button class="btn-success" onclick="exportToExcel()"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> Baixar Excel</button>
    </div>
  </main>
  <div class="watermark watermark-app">¬© 2026 Opportium</div>
</div>

<!-- MODAL -->
<div id="modalOverlay" class="modal-overlay" onclick="closeModal()">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <div>
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px"><span id="modalTribunal" class="tribunal-badge tjsp"></span><span id="modalStatus" class="status-badge andamento"></span></div>
        <div id="modalCNJ" class="processo-cnj" style="font-size:17px"></div>
      </div>
      <button class="modal-close" onclick="closeModal()"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>
    </div>
    <div class="modal-tabs"><button class="modal-tab active" onclick="showModalTab('dados',this)">üìã Dados</button><button class="modal-tab" onclick="showModalTab('partes',this)">üë• Partes</button></div>
    <div id="modalTabDados"><div class="modal-grid" id="modalGrid"></div></div>
    <div id="modalTabPartes" style="display:none"><div id="modalPartes"></div><div id="modalPartesLoading" class="loading-container" style="padding:28px"><div class="loading-spinner"></div><div class="loading-text">Carregando partes...</div></div></div>
    <hr>
    <div class="modal-actions"><button class="btn-primary" id="modalWatchBtn" onclick="addToWatchlist()"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/></svg> Adicionar √† Watchlist</button><button class="btn-secondary" onclick="closeModal()">Fechar</button></div>
  </div>
</div>

<div id="toast" class="toast"><span id="toastIcon">‚úì</span> <span id="toastMsg"></span></div>

<script>
const API_BASE='https://legalscraper-c5a19f03fe5f.herokuapp.com',API_VERSION='/v1';
let token=null,currentUser=null,currentProcesso=null,watchlistCache=[],lastSearchResults=[],exportType='busca',selectedTribunal='';

function formatCurrency(v){return v?new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(v):'R$ 0,00'}
function formatDate(d){if(!d)return'-';try{return new Date(d).toLocaleDateString('pt-BR')}catch{return d}}
function getTribunalClass(t){if(!t)return'tjxx';const x=String(t).toUpperCase();if(x.includes('TJSP')||x.includes('8.26'))return'tjsp';if(x.includes('TJGO')||x.includes('8.09'))return'tjgo';return'tjxx'}
function getStatusClass(s){if(!s)return'andamento';const x=s.toLowerCase();if(x.includes('ativo'))return'ativo';if(x.includes('suspenso'))return'suspenso';if(x.includes('arquivado')||x.includes('baixado'))return'arquivado';return'andamento'}
function showToast(msg,isError=false){const t=document.getElementById('toast');document.getElementById('toastMsg').textContent=msg;document.getElementById('toastIcon').textContent=isError?'‚ö†':'‚úì';t.className='toast active'+(isError?' error':'');setTimeout(()=>t.classList.remove('active'),3000)}

async function apiCall(endpoint,options={}){const url=API_BASE+API_VERSION+endpoint,headers={'Content-Type':'application/json',...options.headers};if(token)headers['Authorization']='Bearer '+token;const res=await fetch(url,{...options,headers});if(res.status===401){showToast('Sess√£o expirada',true);handleLogout();throw new Error('401')}if(!res.ok){const err=await res.json().catch(()=>({}));throw new Error(err.detail||err.message||'Erro')}return await res.json()}

let captchaChecked=false;
function togglePassword(){const i=document.getElementById('loginPassword'),b=document.querySelector('.password-toggle');if(i.type==='password'){i.type='text';b.textContent='Ocultar'}else{i.type='password';b.textContent='Mostrar'}}
function toggleCaptcha(){captchaChecked=!captchaChecked;const box=document.getElementById('captchaBox');box.classList.toggle('checked',captchaChecked);box.querySelector('.captcha-check').style.display=captchaChecked?'block':'none'}

async function handleLogin(){const username=document.getElementById('loginUsername').value.trim(),password=document.getElementById('loginPassword').value,errorDiv=document.getElementById('loginError'),errorText=document.getElementById('loginErrorText'),btn=document.getElementById('loginBtn');if(!username||!password){errorDiv.style.display='flex';errorText.textContent='Preencha todos os campos';return}if(!captchaChecked){errorDiv.style.display='flex';errorText.textContent='Confirme o captcha';return}btn.disabled=true;btn.innerHTML='<span class="spinner"></span> Entrando...';errorDiv.style.display='none';try{const res=await fetch(API_BASE+API_VERSION+'/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});if(!res.ok)throw new Error('Credenciais inv√°lidas');const data=await res.json();token=data.access_token;currentUser={username,role:data.role||'Operador'};localStorage.setItem('ls_token',token);localStorage.setItem('ls_user',JSON.stringify(currentUser));document.getElementById('sidebarName').textContent=username;document.getElementById('sidebarRole').textContent=currentUser.role;document.getElementById('sidebarAvatar').textContent=username.charAt(0).toUpperCase();document.getElementById('loginPage').style.display='none';document.getElementById('app').classList.add('active');initApp()}catch(e){errorDiv.style.display='flex';errorText.textContent=e.message}btn.disabled=false;btn.innerHTML='Entrar'}

function handleLogout(){token=null;currentUser=null;localStorage.removeItem('ls_token');localStorage.removeItem('ls_user');document.getElementById('app').classList.remove('active');document.getElementById('loginPage').style.display='flex';document.getElementById('loginUsername').value='';document.getElementById('loginPassword').value='';captchaChecked=false;document.getElementById('captchaBox').classList.remove('checked');document.querySelector('.captcha-check').style.display='none'}

function initApp(){const now=new Date();document.getElementById('dashTimestamp').textContent=now.toLocaleDateString('pt-BR',{weekday:'long',day:'numeric',month:'long'});loadWatchlist()}

function showPage(id,el){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById('page-'+id).classList.add('active');document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));if(el)el.classList.add('active');if(id==='watchlist')loadWatchlist();if(id==='exportar')updateExportDesc()}

function selectTribunal(el,tribunal){document.querySelectorAll('.tribunal-tag').forEach(t=>t.classList.remove('active'));el.classList.add('active');selectedTribunal=tribunal}

async function doSearch(){const limit=document.getElementById('searchLimit').value;document.getElementById('searchLoading').style.display='flex';document.getElementById('searchEmpty').style.display='none';document.getElementById('searchError').style.display='none';document.getElementById('searchResults').innerHTML='';document.getElementById('searchResultsCount').style.display='none';document.getElementById('searchBtn').disabled=true;try{let endpoint='/processos?limit='+limit;if(selectedTribunal)endpoint+='&tribunal='+selectedTribunal;const data=await apiCall(endpoint);const lista=Array.isArray(data)?data:(data.items||data.processos||[]);lastSearchResults=lista;document.getElementById('searchLoading').style.display='none';if(lista.length===0){document.getElementById('searchEmpty').innerHTML='<div class="empty-icon">üîç</div><div class="empty-title">Nenhum resultado</div>';document.getElementById('searchEmpty').style.display='block'}else{document.getElementById('searchResultsCount').style.display='block';document.getElementById('searchResultsCount').textContent=lista.length+' processo(s) encontrado(s)';document.getElementById('searchResults').innerHTML=lista.map(renderCard).join('');document.getElementById('statLastSearch').textContent=lista.length}}catch(e){document.getElementById('searchLoading').style.display='none';document.getElementById('searchError').style.display='block';document.getElementById('searchErrorText').textContent=e.message}document.getElementById('searchBtn').disabled=false}

function renderCard(p){const cnj=p.numero_cnj||p.cnj||p.processo_numero||'-',tribunal=p.tribunal||'-',classe=p.classe||'-',assunto=p.assunto||'-',autor=p.polo_ativo||p.autor||'-',reu=p.polo_passivo||p.reu||'-',comarca=p.comarca||'-',vara=p.vara||'-',valor=p.valor_causa||p.valor||0,status=p.status||'Em andamento',dist=p.data_distribuicao||'-',mov=p.ultima_movimentacao||'-';return`<div class="processo-card" onclick="openModal('${cnj}')"><div class="processo-header"><div style="display:flex;align-items:center;gap:12px"><span class="processo-cnj">${cnj}</span><span class="tribunal-badge ${getTribunalClass(cnj)}">${tribunal}</span></div><span class="status-badge ${getStatusClass(status)}">${status}</span></div><div class="processo-grid"><div><div class="processo-label">Classe</div><div class="processo-value">${classe}</div></div><div><div class="processo-label">Assunto</div><div class="processo-value">${assunto}</div></div><div><div class="processo-label">Valor</div><div class="processo-value valor">${formatCurrency(valor)}</div></div><div><div class="processo-label">Autor</div><div class="processo-value">${autor}</div></div><div><div class="processo-label">R√©u</div><div class="processo-value">${reu}</div></div><div><div class="processo-label">Comarca/Vara</div><div class="processo-value">${comarca} ‚Äî ${vara}</div></div></div><div class="processo-mov"><span class="dot"></span><span style="color:var(--text-muted)">${formatDate(dist)}</span> ${mov}</div></div>`}

async function openModal(cnj){try{const p=await apiCall('/processos/'+encodeURIComponent(cnj));currentProcesso=p;document.getElementById('modalTribunal').className='tribunal-badge '+getTribunalClass(p.numero_cnj||cnj);document.getElementById('modalTribunal').textContent=p.tribunal||'-';document.getElementById('modalStatus').className='status-badge '+getStatusClass(p.status);document.getElementById('modalStatus').textContent=p.status||'-';document.getElementById('modalCNJ').textContent=p.numero_cnj||cnj;const campos=[['Classe',p.classe],['Assunto',p.assunto],['Polo Ativo',p.polo_ativo],['Polo Passivo',p.polo_passivo],['Comarca',p.comarca],['Vara',p.vara],['UF',p.uf],['Inst√¢ncia',p.instancia],['Distribui√ß√£o',formatDate(p.data_distribuicao)],['Atualiza√ß√£o',formatDate(p.data_atualizacao)],['Valor',formatCurrency(p.valor_causa)],['√öltima Mov.',p.ultima_movimentacao]];document.getElementById('modalGrid').innerHTML=campos.map(([l,v])=>`<div><div class="processo-label">${l}</div><div class="processo-value${l==='Valor'?' valor':''}">${v||'-'}</div></div>`).join('');showModalTab('dados',document.querySelector('.modal-tab'));document.getElementById('modalOverlay').classList.add('active')}catch(e){showToast('Erro: '+e.message,true)}}

function showModalTab(tab,el){document.querySelectorAll('.modal-tab').forEach(t=>t.classList.remove('active'));el.classList.add('active');document.getElementById('modalTabDados').style.display=tab==='dados'?'block':'none';document.getElementById('modalTabPartes').style.display=tab==='partes'?'block':'none';if(tab==='partes'&&currentProcesso)loadPartes(currentProcesso.numero_cnj)}

async function loadPartes(cnj){document.getElementById('modalPartes').innerHTML='';document.getElementById('modalPartesLoading').style.display='flex';try{const data=await apiCall('/processos/'+encodeURIComponent(cnj)+'/partes');const lista=Array.isArray(data)?data:(data.partes||[]);document.getElementById('modalPartesLoading').style.display='none';if(lista.length===0){document.getElementById('modalPartes').innerHTML='<div style="text-align:center;padding:28px;color:var(--text-muted)">Nenhuma parte encontrada</div>'}else{document.getElementById('modalPartes').innerHTML=lista.map(p=>`<div class="parte-card"><div class="parte-tipo ${(p.tipo||'').toLowerCase().includes('ativo')?'autor':'reu'}">${p.tipo||'Parte'}</div><div class="parte-nome">${p.nome||'-'}</div><div class="parte-doc">${p.documento||''}</div>${p.advogados?.length?`<div class="parte-adv"><strong>Adv:</strong> ${p.advogados.map(a=>a.nome+(a.oab?' ('+a.oab+')':'')).join(', ')}</div>`:''}</div>`).join('')}}catch(e){document.getElementById('modalPartesLoading').style.display='none';document.getElementById('modalPartes').innerHTML='<div style="text-align:center;padding:28px;color:var(--error)">Erro ao carregar</div>'}}

function closeModal(){document.getElementById('modalOverlay').classList.remove('active');currentProcesso=null}

async function loadWatchlist(){document.getElementById('watchLoading').style.display='flex';document.getElementById('watchResults').innerHTML='';document.getElementById('watchEmpty').style.display='none';try{const data=await apiCall('/watchlist');watchlistCache=Array.isArray(data)?data:(data.items||data.watchlist||[]);document.getElementById('watchLoading').style.display='none';document.getElementById('watchBadge').textContent=watchlistCache.length;document.getElementById('statWatched').textContent=watchlistCache.length;document.getElementById('watchSubtitle').textContent=watchlistCache.length+' processo(s) monitorado(s)';if(watchlistCache.length===0){document.getElementById('watchEmpty').style.display='block'}else{document.getElementById('watchResults').innerHTML=watchlistCache.map(w=>`<div class="processo-card" onclick="openModal('${w.cnj||w.processo_numero}')"><div class="processo-header"><span class="processo-cnj">${w.cnj||w.processo_numero||'-'}</span><span style="color:var(--text-muted)">Adicionado: ${formatDate(w.created_at)}</span></div></div>`).join('')}}catch(e){document.getElementById('watchLoading').style.display='none';document.getElementById('watchEmpty').innerHTML='<div class="empty-icon">‚ö†Ô∏è</div><div class="empty-title">Erro</div><div style="margin-top:8px">'+e.message+'</div>';document.getElementById('watchEmpty').style.display='block'}}

async function addToWatchlist(){if(!currentProcesso)return;const cnj=currentProcesso.numero_cnj,btn=document.getElementById('modalWatchBtn');btn.disabled=true;btn.innerHTML='<span class="spinner" style="width:16px;height:16px"></span>';try{await apiCall('/watchlist',{method:'POST',body:JSON.stringify({cnj})});showToast('Adicionado!');closeModal();loadWatchlist()}catch(e){showToast('Erro: '+e.message,true)}btn.disabled=false;btn.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/></svg> Adicionar √† Watchlist'}

function selectExportOption(el,type){document.querySelectorAll('.export-option').forEach(o=>o.classList.remove('selected'));el.classList.add('selected');exportType=type}
function updateExportDesc(){document.getElementById('exportBuscaDesc').textContent=lastSearchResults.length>0?lastSearchResults.length+' processos':'Nenhuma busca';document.getElementById('exportWatchDesc').textContent=watchlistCache.length+' processos'}
function exportToExcel(){const data=exportType==='busca'?lastSearchResults:watchlistCache;if(!data.length){showToast('Nenhum dado',true);return}const rows=data.map(p=>({'N√∫mero CNJ':p.numero_cnj||p.cnj||'-','Tribunal':p.tribunal||'-','Classe':p.classe||'-','Assunto':p.assunto||'-','Polo Ativo':p.polo_ativo||'-','Polo Passivo':p.polo_passivo||'-','Comarca':p.comarca||'-','Vara':p.vara||'-','Valor':p.valor_causa||0,'Status':p.status||'-','Distribui√ß√£o':p.data_distribuicao||'-','√öltima Mov.':p.ultima_movimentacao||'-'}));const ws=XLSX.utils.json_to_sheet(rows),wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,'Processos');XLSX.writeFile(wb,'legalscraper_'+new Date().toISOString().slice(0,10)+'.xlsx');showToast('Excel exportado!')}

document.addEventListener('DOMContentLoaded',()=>{const savedToken=localStorage.getItem('ls_token'),savedUser=localStorage.getItem('ls_user');if(savedToken&&savedUser){token=savedToken;currentUser=JSON.parse(savedUser);document.getElementById('sidebarName').textContent=currentUser.username;document.getElementById('sidebarRole').textContent=currentUser.role;document.getElementById('sidebarAvatar').textContent=currentUser.username.charAt(0).toUpperCase();document.getElementById('loginPage').style.display='none';document.getElementById('app').classList.add('active');initApp()}['loginUsername','loginPassword'].forEach(id=>{document.getElementById(id).addEventListener('keydown',e=>{if(e.key==='Enter')handleLogin()})});document.addEventListener('keydown',e=>{if(e.key==='Escape')closeModal()})});
</script>
</body>
</html>
